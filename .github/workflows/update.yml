name: ğŸš€ Auto Update File List

on:
  push:
    paths:
      - 'files/**'
  workflow_dispatch:

jobs:
  update-file-list:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ”„ Generate file list with direct links
      run: |
        echo "[" > file-list.json
        
        count=0
        for file in files/*.pdf; do
          if [ -f "$file" ]; then
            if [ $count -gt 0 ]; then
              echo "," >> file-list.json
            fi
            
            filename=$(basename "$file")
            size=$(stat -c%s "$file")
            modified=$(date -r "$file" +"%d.%m.%Y")
            
            # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€
            if [ $size -gt 1048576 ]; then
              size_display=$(echo "scale=1; $size/1048576" | bc)" MB"
            else
              size_display=$(echo "scale=1; $size/1024" | bc)" KB"
            fi
            
            # ĞŸÑ€ÑĞ¼Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° raw Ñ„Ğ°Ğ¹Ğ»
            raw_url="https://raw.githubusercontent.com/${{ github.repository }}/main/files/$filename"
            
            # ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
            description="Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚"
            [[ $filename == *"Ğ¾Ñ‚Ñ‡ĞµÑ‚"* ]] && description="Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡ĞµÑ‚"
            [[ $filename == *"Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†"* ]] && description="Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ"
            [[ $filename == *"Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†"* ]] && description="ĞŸÑ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ"
            
            cat >> file-list.json << EOF
            {
              "name": "$filename",
              "url": "$raw_url",
              "size": "$size_display",
              "modified": "$modified", 
              "description": "$description"
            }
EOF
            count=$((count+1))
          fi
        done
        
        echo "" >> file-list.json
        echo "]" >> file-list.json
        
        echo "âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹: $count"
        
    - name: ğŸ’¾ Commit changes
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git add file-list.json
        git diff --staged --quiet || git commit -m "ğŸ¤– Auto-update file list"
        git push
